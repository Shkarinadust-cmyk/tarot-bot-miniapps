import logging
import os
import random
import time
import sqlite3
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import Application, CommandHandler, MessageHandler, filters, ContextTypes

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO
)
logger = logging.getLogger(__name__)

# –¢–æ–∫–µ–Ω –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
BOT_TOKEN = "8355095598:AAGi48QWU-4e66ZTR2qMYU6aiK-Py1TxjWU"

# –ü—É—Ç—å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
DATABASE_PATH = os.path.join(os.path.dirname(__file__), '..', 'tarot_bot.db')

class AdvancedTarotAI:
    def __init__(self):
        self.cards_detailed = {
            "üÉè –®–£–¢": {
                "meaning": "–ù–∞—á–∞–ª–æ –Ω–æ–≤–æ–≥–æ –ø—É—Ç–∏, –Ω–µ–≤–∏–Ω–Ω–æ—Å—Ç—å, —Å–ø–æ–Ω—Ç–∞–Ω–Ω–æ—Å—Ç—å, —Å–≤–æ–±–æ–¥–∞ –æ—Ç —É—Å–ª–æ–≤–Ω–æ—Å—Ç–µ–π",
                "love": "üíñ –ù–æ–≤—ã–µ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞, –ª–µ–≥–∫–∏–π —Ñ–ª–∏—Ä—Ç, –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –≤—Å—Ç—Ä–µ—á–∏. –ù–µ –±–æ–π—Ç–µ—Å—å –ø—Ä–æ—è–≤–ª—è—Ç—å –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É! –í–æ–∑–º–æ–∂–Ω–æ, —Å—É–¥—å–±–∞ –≥–æ—Ç–æ–≤–∏—Ç –≤–∞–º –ø—Ä–∏—è—Ç–Ω—ã–π —Å—é—Ä–ø—Ä–∏–∑.",
                "career": "üíº –°—Ç–∞—Ä—Ç –ø—Ä–æ–µ–∫—Ç–æ–≤, —Ç–≤–æ—Ä—á–µ—Å–∫–∏–π –ø–æ–¥—Ö–æ–¥, –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ –∏–¥–µ–∏. –†–∏—Å–∫—É–π—Ç–µ - —ç—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–º—É —É—Å–ø–µ—Ö—É!",
                "advice": "üåü –î–æ–≤–µ—Ä—å—Ç–µ—Å—å –∏–Ω—Ç—É–∏—Ü–∏–∏ –∏ –±—É–¥—å—Ç–µ –æ—Ç–∫—Ä—ã—Ç—ã –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º. –ò–Ω–æ–≥–¥–∞ –ª—É—á—à–∏–π –ø—É—Ç—å - —Ç–æ—Ç, —á—Ç–æ –Ω–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–ª—Å—è."
            },
            "üßô‚Äç‚ôÄÔ∏è –ñ–†–ò–¶–ê": {
                "meaning": "–ò–Ω—Ç—É–∏—Ü–∏—è, —Ç–∞–π–Ω—ã, –ø–æ–¥—Å–æ–∑–Ω–∞–Ω–∏–µ, –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –º—É–¥—Ä–æ—Å—Ç—å, —Å–∫—Ä—ã—Ç—ã–µ –∑–Ω–∞–Ω–∏—è",
                "love": "üí´ –ì–ª—É–±–æ–∫–∏–µ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Å–≤—è–∑–∏, —Ç–µ–ª–µ–ø–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ. –ü—Ä–∏—Å–ª—É—à–∞–π—Ç–µ—Å—å –∫ —Å–µ—Ä–¥—Ü—É, –∞ –Ω–µ –∫ —Ä–∞–∑—É–º—É. –í–æ–∑–º–æ–∂–Ω–∞ –≤—Å—Ç—Ä–µ—á–∞ —Å —Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–æ–π –¥—É—à–æ–π.",
                "career": "üîÆ –°–∫—Ä—ã—Ç—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏, —Ä–∞–±–æ—Ç–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π. –ü—Ä–æ—è–≤–∏—Ç–µ —Ç–µ—Ä–ø–µ–Ω–∏–µ - –≤—Å–µ –ø—Ä–æ—è—Å–Ω–∏—Ç—Å—è –≤ –Ω—É–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç. –î–æ–≤–µ—Ä—è–π—Ç–µ –ø—Ä–µ–¥—á—É–≤—Å—Ç–≤–∏—è–º.",
                "advice": "üìñ –†–∞–∑–≤–∏–≤–∞–π—Ç–µ –∏–Ω—Ç—É–∏—Ü–∏—é —á–µ—Ä–µ–∑ –º–µ–¥–∏—Ç–∞—Ü–∏—é –∏ —Å–∞–º–æ–∞–Ω–∞–ª–∏–∑. –û—Ç–≤–µ—Ç—ã –ø—Ä–∏–¥—É—Ç –∏–∑–Ω—É—Ç—Ä–∏, –∞ –Ω–µ –∏–∑–≤–Ω–µ."
            },
            "üëë –ò–ú–ü–ï–†–ê–¢–†–ò–¶–ê": {
                "meaning": "–ò–∑–æ–±–∏–ª–∏–µ, —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ, –∫—Ä–∞—Å–æ—Ç–∞, –ø–ª–æ–¥–æ—Ä–æ–¥–∏–µ, –≥–∞—Ä–º–æ–Ω–∏—è, –º–∞—Ç–µ—Ä–∏–Ω—Å—Ç–≤–æ",
                "love": "üåπ –ü–µ—Ä–∏–æ–¥ —Ä–∞—Å—Ü–≤–µ—Ç–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏–π. –†–æ–º–∞–Ω—Ç–∏–∫–∞, —Å—Ç—Ä–∞—Å—Ç—å, –∑–∞–±–æ—Ç–∞. –í–æ–∑–º–æ–∂–Ω–æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ —Å–µ–º—å–µ –∏–ª–∏ –≥–ª—É–±–æ–∫–æ–µ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–±–ª–∏–∂–µ–Ω–∏–µ.",
                "career": "üé® –¢–≤–æ—Ä—á–µ—Å–∫–∏–µ –ø—Ä–æ–µ–∫—Ç—ã, —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ä–æ—Å—Ç, –±–ª–∞–≥–æ–ø–æ–ª—É—á–∏–µ. –í–∞—à–∏ —Ç–∞–ª–∞–Ω—Ç—ã –ø—Ä–∏–Ω–µ—Å—É—Ç –ø–ª–æ–¥—ã. –ò–¥–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è —Å–∞–º–æ–≤—ã—Ä–∞–∂–µ–Ω–∏—è.",
                "advice": "üåø –û–∫—Ä—É–∂–∏—Ç–µ —Å–µ–±—è –∫—Ä–∞—Å–æ—Ç–æ–π –∏ –∑–∞–±–æ—Ç—å—Ç–µ—Å—å –æ –∫–æ–º—Ñ–æ—Ä—Ç–µ. –¢–≤–æ—Ä—á–µ—Å–∫–∞—è —ç–Ω–µ—Ä–≥–∏—è –Ω—É–∂–¥–∞–µ—Ç—Å—è –≤ –ø–∏—Ç–∞—Ç–µ–ª—å–Ω–æ–π —Å—Ä–µ–¥–µ."
            },
            "üíë –í–õ–Æ–ë–õ–ï–ù–ù–´–ï": {
                "meaning": "–õ—é–±–æ–≤—å, –≤—ã–±–æ—Ä, –≥–∞—Ä–º–æ–Ω–∏—è, –ø–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–æ, –µ–¥–∏–Ω—Å—Ç–≤–æ, —Å—É–¥—å–±–æ–Ω–æ—Å–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è",
                "love": "üíû –í–∞–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö. –ì–ª—É–±–æ–∫–∏–µ —á—É–≤—Å—Ç–≤–∞, –≤–æ–∑–º–æ–∂–Ω–æ —Å—É–¥—å–±–æ–Ω–æ—Å–Ω–∞—è –≤—Å—Ç—Ä–µ—á–∞. –ö–∞—Ä—Ç–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –∫–∞—Ä–º–∏—á–µ—Å–∫–∏–µ —Å–≤—è–∑–∏.",
                "career": "ü§ù –ü–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–æ, —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ, –≤—ã–±–æ—Ä –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º–∏. –ê–ª—å—è–Ω—Å—ã –ø—Ä–∏–Ω–µ—Å—É—Ç —É—Å–ø–µ—Ö.",
                "advice": "‚öñÔ∏è –°–ª—É—à–∞–π—Ç–µ —Å–µ—Ä–¥—Ü–µ, –Ω–æ –Ω–µ –∑–∞–±—ã–≤–∞–π—Ç–µ –æ —Ä–∞–∑—É–º–µ –ø—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ —Ä–µ—à–µ–Ω–∏–π. –ò—Å—Ç–∏–Ω–Ω—ã–π –≤—ã–±–æ—Ä –≤—Å–µ–≥–¥–∞ –∏–¥–µ—Ç –æ—Ç –¥—É—à–∏."
            },
            "‚öîÔ∏è –°–ò–õ–ê": {
                "meaning": "–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å–∏–ª–∞, —Å–º–µ–ª–æ—Å—Ç—å, —Å—Ç—Ä–∞—Å—Ç—å, —Ç–µ—Ä–ø–µ–Ω–∏–µ, —Å–æ—Å—Ç—Ä–∞–¥–∞–Ω–∏–µ, –º—è–≥–∫–∞—è –≤–ª–∞—Å—Ç—å",
                "love": "üî• –°—Ç—Ä–∞—Å—Ç–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è, –ø—Ä–µ–æ–¥–æ–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤. –õ—é–±–æ–≤—å –ø–æ–±–µ–∂–¥–∞–µ—Ç –≤—Å–µ –ø—Ä–µ–≥—Ä–∞–¥—ã —á–µ—Ä–µ–∑ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –∏ —Ç–µ—Ä–ø–µ–Ω–∏–µ.",
                "career": "üí™ –£–ø–æ—Ä—Å—Ç–≤–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ —É—Å–ø–µ—Ö—É. –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–π—Ç–µ —ç–º–æ—Ü–∏–∏ –≤ –¥–µ–ª–æ–≤—ã—Ö –≤–æ–ø—Ä–æ—Å–∞—Ö. –í–∞—à–∞ —Å—Ç–æ–π–∫–æ—Å—Ç—å –≤–ø–µ—á–∞—Ç–ª—è–µ—Ç.",
                "advice": "ü¶Å –ü—Ä–æ—è–≤–∏—Ç–µ –º—è–≥–∫—É—é —Å–∏–ª—É - –Ω–∞—Å—Ç–æ—è—â–∞—è –º–æ—â—å –≤ —É–º–µ–Ω–∏–∏ –¥–æ–≥–æ–≤–∞—Ä–∏–≤–∞—Ç—å—Å—è –∏ –ø–æ–Ω–∏–º–∞—Ç—å."
            },
            "üé° –ö–û–õ–ï–°–û –§–û–†–¢–£–ù–´": {
                "meaning": "–°—É–¥—å–±–∞, —É–¥–∞—á–∞, –ø–µ—Ä–µ–º–µ–Ω—ã, —Ü–∏–∫–ª—ã, –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –ø–æ–≤–æ—Ä–æ—Ç—ã, –∫–∞—Ä–º–∏—á–µ—Å–∫–∏–µ —É—Ä–æ–∫–∏",
                "love": "üéØ –°—É–¥—å–±–æ–Ω–æ—Å–Ω—ã–µ –≤—Å—Ç—Ä–µ—á–∏, –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –ø–æ–≤–æ—Ä–æ—Ç—ã –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö. –î–æ–≤–µ—Ä—å—Ç–µ—Å—å —Ç–µ—á–µ–Ω–∏—é –∂–∏–∑–Ω–∏ - –≤—Å–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–æ–≤—Ä–µ–º—è.",
                "career": "üöÄ –£–¥–∞—á–Ω—ã–π –ø–µ—Ä–∏–æ–¥, –∫–∞—Ä—å–µ—Ä–Ω—ã–π –≤–∑–ª–µ—Ç. –ë—É–¥—å—Ç–µ –≥–æ—Ç–æ–≤—ã –∫ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º. –§–æ—Ä—Ç—É–Ω–∞ –Ω–∞ –≤–∞—à–µ–π —Å—Ç–æ—Ä–æ–Ω–µ.",
                "advice": "üåÄ –ü—Ä–∏–º–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω—ã - –æ–Ω–∏ –≤–µ–¥—É—Ç –∫ –ª—É—á—à–µ–º—É. –ò–Ω–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –æ—Ç–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—å –∏ –¥–æ–≤–µ—Ä–∏—Ç—å—Å—è –≤—Å–µ–ª–µ–Ω–Ω–æ–π."
            },
            "‚òÄÔ∏è –°–û–õ–ù–¶–ï": {
                "meaning": "–†–∞–¥–æ—Å—Ç—å, —É—Å–ø–µ—Ö, —Å—á–∞—Å—Ç—å–µ, –æ–ø—Ç–∏–º–∏–∑–º, —è—Å–Ω–æ—Å—Ç—å, –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è, –¥–µ—Ç—Å–∫–∞—è —á–∏—Å—Ç–æ—Ç–∞",
                "love": "üåà –°—á–∞—Å—Ç–ª–∏–≤—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è, –≤–∑–∞–∏–º–Ω–∞—è –ª—é–±–æ–≤—å, –∏—Å–∫—Ä–µ–Ω–Ω–æ—Å—Ç—å. –ü–µ—Ä–∏–æ–¥ –≥–∞—Ä–º–æ–Ω–∏–∏ –∏ –ø–æ–Ω–∏–º–∞–Ω–∏—è. –ï—Å–ª–∏ –æ–¥–∏–Ω–æ–∫–∏ - —Å–∫–æ—Ä–æ –≤—Å—Ç—Ä–µ—Ç–∏—Ç–µ —Å–≤–µ—Ç–ª–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞.",
                "career": "üèÜ –£—Å–ø–µ—Ö, –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ, –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è. –í–∞—à–∏ —Ç—Ä—É–¥—ã –±—É–¥—É—Ç –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω—ã. –ö–∞—Ä—Ç–∞ –æ–±–µ—â–∞–µ—Ç –±–ª–µ—Å—Ç—è—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.",
                "advice": "üéâ –ù–∞—Å–ª–∞–∂–¥–∞–π—Ç–µ—Å—å –∂–∏–∑–Ω—å—é –∏ –¥–µ–ª–∏—Ç–µ—Å—å —Ä–∞–¥–æ—Å—Ç—å—é —Å –æ–∫—Ä—É–∂–∞—é—â–∏–º–∏. –ü–æ–∑–∏—Ç–∏–≤–Ω–æ–µ –º—ã—à–ª–µ–Ω–∏–µ –ø—Ä–∏–≤–ª–µ–∫–∞–µ—Ç —É–¥–∞—á—É."
            },
            "üíÄ –°–ú–ï–†–¢–¨": {
                "meaning": "–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è, –∫–æ–Ω–µ—Ü, –Ω–æ–≤–æ–µ –Ω–∞—á–∞–ª–æ, –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ, –≤–æ–∑—Ä–æ–∂–¥–µ–Ω–∏–µ, –≥–ª—É–±–æ–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è",
                "love": "ü¶ã –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ —ç—Ç–∞–ø–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏–π, –Ω–∞—á–∞–ª–æ –Ω–æ–≤–æ–≥–æ. –ù–µ –±–æ–π—Ç–µ—Å—å –ø–µ—Ä–µ–º–µ–Ω - –æ–Ω–∏ –æ—á–∏—â–∞—é—Ç –ø—É—Ç—å –¥–ª—è –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ.",
                "career": "üîÑ –°–º–µ–Ω–∞ —Ä–∞–±–æ—Ç—ã, –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–≤. –°—Ç–∞—Ä–æ–µ —É—Ö–æ–¥–∏—Ç, —á—Ç–æ–±—ã –æ—Å–≤–æ–±–æ–¥–∏—Ç—å –º–µ—Å—Ç–æ –Ω–æ–≤–æ–º—É, –±–æ–ª–µ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º—É –≤–∞–º.",
                "advice": "üçÇ –ü—Ä–∏–º–∏—Ç–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è - –æ–Ω–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã –¥–ª—è –Ω–æ–≤—ã—Ö –Ω–∞—á–∏–Ω–∞–Ω–∏–π. –ö–∞–∂–¥–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –Ω–µ—Å–µ—Ç —Å–µ–º—è –Ω–æ–≤–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞."
            },
            "üåç –ú–ò–†": {
                "meaning": "–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ, —É—Å–ø–µ—Ö, –≥–∞—Ä–º–æ–Ω–∏—è, —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å, –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ, –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è, –µ–¥–∏–Ω—Å—Ç–≤–æ",
                "love": "üíí –ì–∞—Ä–º–æ–Ω–∏—á–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è, –≤–æ–∑–º–æ–∂–µ–Ω –±—Ä–∞–∫. –ß—É–≤—Å—Ç–≤–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ—Å—Ç–∏ –∏ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–∏—è. –ö–∞—Ä—Ç–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Å–æ—é–∑ –¥—É—à.",
                "career": "üéì –£—Å–ø–µ—à–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–≤, –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ü–µ–ª–µ–π. –ù–∞—Å–ª–∞–∂–¥–∞–π—Ç–µ—Å—å –ø–ª–æ–¥–∞–º–∏ —Ç—Ä—É–¥–∞. –ü—Ä–∏—à–ª–æ –≤—Ä–µ–º—è –ø–æ–∂–∏–Ω–∞—Ç—å —É—Ä–æ–∂–∞–π.",
                "advice": "üïäÔ∏è –í—ã –≤ –≥–∞—Ä–º–æ–Ω–∏–∏ —Å –º–∏—Ä–æ–º - —Ü–µ–Ω–∏—Ç–µ —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç –∏ –≥–æ—Ç–æ–≤—å—Ç–µ—Å—å –∫ –Ω–æ–≤–æ–º—É —Ü–∏–∫–ª—É. –°–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ."
            }
        }
        
        self.thinking_phrases = [
            "üîÆ –ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π –≤–æ–ø—Ä–æ—Å... –ü–æ–∑–≤–æ–ª—å—Ç–µ –º–Ω–µ —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏—Ç—å—Å—è –∏ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –º—É–¥—Ä–æ—Å—Ç–∏ –∫–∞—Ä—Ç...",
            "‚ú® –ß—É–≤—Å—Ç–≤—É—é –≤–∞–∂–Ω–æ—Å—Ç—å –≤–∞—à–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞... –ö–∞—Ä—Ç—ã —É–∂–µ –Ω–∞—á–∏–Ω–∞—é—Ç —Ä–∞—Å–∫—Ä—ã–≤–∞—Ç—å —Å–≤–æ–∏ —Ç–∞–π–Ω—ã...",
            "üí´ –û–±—Ä–∞—â–∞—é—Å—å –∫ –ê—Ä–∫–∞–Ω–∞–º... –î–∞–≤–∞–π—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–∏–º, —á—Ç–æ –æ–Ω–∏ –ø—Ä–∏–≥–æ—Ç–æ–≤–∏–ª–∏ –¥–ª—è –≤–∞—Å...",
            "üé¥ –ö–∞—Ä—Ç—ã –ª–æ–∂–∞—Ç—Å—è –≤ –æ—Å–æ–±—ã–π —Ä–∞—Å–∫–ª–∞–¥... –°–µ–∫—É–Ω–¥—É, —è –∏–∑—É—á–∞—é –∏—Ö –ø–æ—Å–ª–∞–Ω–∏–µ...",
            "üåü –í–∞—à –≤–æ–ø—Ä–æ—Å resonates —Å —ç–Ω–µ—Ä–≥–∏–µ–π –í—Å–µ–ª–µ–Ω–Ω–æ–π... –ö–∞—Ä—Ç—ã –æ—Ç–≤–µ—á–∞—é—Ç..."
        ]

    def get_thinking_phrase(self):
        return random.choice(self.thinking_phrases)
    
    def analyze_question_type(self, question):
        """–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–∏–ø –≤–æ–ø—Ä–æ—Å–∞ –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–∞"""
        question_lower = question.lower()
        
        if any(word in question_lower for word in ['–ª—é–±–æ–≤', '–æ—Ç–Ω–æ—à–µ–Ω', '–±—Ä–∞–∫', '—Å–µ–º—å', '–ø–∞—Ä—Ç–Ω–µ—Ä', '—á—É–≤—Å—Ç–≤', '—Å–µ—Ä–¥—Ü', '–≤—Å—Ç—Ä–µ—á', '—Å–µ–º–µ–π']):
            return "love"
        elif any(word in question_lower for word in ['—Ä–∞–±–æ—Ç', '–∫–∞—Ä—å–µ—Ä', '–¥–µ–Ω—å–≥', '—Ñ–∏–Ω–∞–Ω—Å', '–±–∏–∑–Ω–µ—Å', '–ø—Ä–æ–µ–∫—Ç', '–∑–∞—Ä–ø–ª–∞—Ç', '–¥–æ–ª–∂–Ω–æ—Å—Ç']):
            return "career"
        else:
            return "general"
    
    def create_intelligent_reading(self, question):
        """–°–æ–∑–¥–∞–µ—Ç –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π —Ä–∞—Å–∫–ª–∞–¥ —Å –≥–ª—É–±–æ–∫–∏–º–∏ —Ç—Ä–∞–∫—Ç–æ–≤–∫–∞–º–∏"""
        question_type = self.analyze_question_type(question)
        selected_cards = random.sample(list(self.cards_detailed.keys()), 3)
        
        reading = f"üîÆ **–í–ê–® –í–û–ü–†–û–°:** \"{question}\"\n\n"
        reading += "‚ú® **–ü–†–û–§–ï–°–°–ò–û–ù–ê–õ–¨–ù–´–ô –†–ê–°–ö–õ–ê–î –ù–ê 3 –ö–ê–†–¢–´** ‚ú®\n\n"
        
        positions = [
            "üß≠ **–ù–ê–°–¢–û–Ø–©–ê–Ø –°–ò–¢–£–ê–¶–ò–Ø** - —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–µ–π—á–∞—Å",
            "üõ§Ô∏è **–í–ê–® –ü–£–¢–¨** - –∫–∞–∫ –≤–∞–º –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å", 
            "üéØ **–í–û–ó–ú–û–ñ–ù–´–ô –ò–°–•–û–î** - –∫ —á–µ–º—É –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏"
        ]
        
        for i, card in enumerate(selected_cards):
            card_info = self.cards_detailed[card]
            
            reading += f"{positions[i]}\n"
            reading += f"üé¥ **{card}**\n"
            
            if question_type == "love":
                reading += f"{card_info['love']}\n"
            elif question_type == "career":
                reading += f"{card_info['career']}\n"
            else:
                reading += f"üìú {card_info['meaning']}\n"
            
            reading += f"üí´ *–°–æ–≤–µ—Ç:* {card_info['advice']}\n\n"
        
        # –ì–ª—É–±–æ–∫–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–∞—Å–∫–ª–∞–¥–∞
        reading += "---\n"
        reading += "üíé **–ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –†–ê–°–ö–õ–ê–î–ê:**\n\n"
        
        card1, card2, card3 = selected_cards
        
        if question_type == "love":
            if "–°–û–õ–ù–¶–ï" in card3 or "–ú–ò–†" in card3:
                reading += f"–ö–æ–º–±–∏–Ω–∞—Ü–∏—è **{card1.split(' ')[1]}**, **{card2.split(' ')[1]}** –∏ **{card3.split(' ')[1]}** –æ–±–µ—â–∞–µ—Ç –≥–∞—Ä–º–æ–Ω–∏—á–Ω–æ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–π! "
                reading += "–ö–∞—Ä—Ç—ã –≤–∏–¥—è—Ç —Å–≤–µ—Ç–ª–æ–µ –±—É–¥—É—â–µ–µ –≤ –ª–∏—á–Ω–æ–π –∂–∏–∑–Ω–∏. üåü"
            elif "–°–ú–ï–†–¢–¨" in card3 or "–ë–ê–®–ù–Ø" in card3:
                reading += f"–†–∞—Å–∫–ª–∞–¥ **{card1.split(' ')[1]}** ‚Üí **{card2.split(' ')[1]}** ‚Üí **{card3.split(' ')[1]}** —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏. "
                reading += "–°—Ç–∞—Ä–æ–µ —É—Ö–æ–¥–∏—Ç, –æ—Å–≤–æ–±–æ–∂–¥–∞—è –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –¥–ª—è –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ. üîÑ"
            else:
                reading += f"–ö–∞—Ä—Ç—ã **{card1.split(' ')[1]}**, **{card2.split(' ')[1]}** –∏ **{card3.split(' ')[1]}** —Å–æ–≤–µ—Ç—É—é—Ç –ø—Ä–æ—è–≤–∏—Ç—å –º—É–¥—Ä–æ—Å—Ç—å –∏ —Ç–µ—Ä–ø–µ–Ω–∏–µ. "
                reading += "–õ–∏—á–Ω–∞—è –∂–∏–∑–Ω—å —Ç—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ–≥–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—è. üíù"
                
        elif question_type == "career":
            if "–°–û–õ–ù–¶–ï" in card3 or "–ú–ò–†" in card3 or "–ò–ú–ü–ï–†–ê–¢–û–†" in card3:
                reading += f"–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã –≤—ã–≥–ª—è–¥—è—Ç –±–ª–µ—Å—Ç—è—â–µ! –ö–æ–º–±–∏–Ω–∞—Ü–∏—è **{card1.split(' ')[1]}** ‚Üí **{card2.split(' ')[1]}** ‚Üí **{card3.split(' ')[1]}** "
                reading += "—Å—É–ª–∏—Ç –∫–∞—Ä—å–µ—Ä–Ω—ã–π –≤–∑–ª–µ—Ç –∏ –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ. üöÄ"
            elif "–®–£–¢" in card3 or "–ö–û–õ–ï–°–û –§–û–†–¢–£–ù–´" in card3:
                reading += f"–ñ–¥–∏—Ç–µ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π! –†–∞—Å–∫–ª–∞–¥ **{card1.split(' ')[1]}** + **{card2.split(' ')[1]}** + **{card3.split(' ')[1]}** "
                reading += "–ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –∏ –Ω–æ–≤—ã–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç—ã. üé°"
            else:
                reading += f"–ö–∞—Ä—Ç—ã **{card1.split(' ')[1]}**, **{card2.split(' ')[1]}** –∏ **{card3.split(' ')[1]}** –≤–∏–¥—è—Ç –≤–∞—à –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª. "
                reading += "–ü—Ä–æ—è–≤–∏—Ç–µ –Ω–∞—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å - —É—Å–ø–µ—Ö —Ç—Ä–µ–±—É–µ—Ç —É—Å–∏–ª–∏–π. üíº"
        else:
            reading += f"–ö–æ–º–±–∏–Ω–∞—Ü–∏—è **{card1.split(' ')[1]}**, **{card2.split(' ')[1]}** –∏ **{card3.split(' ')[1]}** —Å–æ–∑–¥–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω. "
            reading += "–ö–∞—Ä—Ç—ã —Å–æ–≤–µ—Ç—É—é—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –¥–µ–π—Å—Ç–≤–∏–µ–º –∏ –ø—Ä–∏–Ω—è—Ç–∏–µ–º, –¥–æ–≤–µ—Ä—è—è –º—É–¥—Ä–æ—Å—Ç–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—â–µ–≥–æ."
        
        reading += f"\n\nüåü *–ü—É—Å—Ç—å –º—É–¥—Ä–æ—Å—Ç—å –¢–∞—Ä–æ –æ—Å–≤–µ—â–∞–µ—Ç –≤–∞—à –ø—É—Ç—å!*"
        
        return reading

# –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –ò–ò
tarot_ai = AdvancedTarotAI()

# –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
def get_user_balance(user_id):
    """–ü–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    try:
        conn = sqlite3.connect(DATABASE_PATH)
        c = conn.cursor()
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
        c.execute('SELECT balance FROM users WHERE user_id = ?', (user_id,))
        result = c.fetchone()
        
        if result:
            balance = result[0]
            conn.close()
            return balance
        else:
            # –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å 10 –≤–æ–ø—Ä–æ—Å–∞–º–∏
            c.execute('INSERT INTO users (user_id, balance) VALUES (?, ?)', (user_id, 10))
            conn.commit()
            conn.close()
            print(f"‚úÖ –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id} —Å 10 –≤–æ–ø—Ä–æ—Å–∞–º–∏")
            return 10
            
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞: {e}")
        return 0

def decrease_balance(user_id):
    """–£–º–µ–Ω—å—à–∏—Ç—å –±–∞–ª–∞–Ω—Å –Ω–∞ 1 –≤–æ–ø—Ä–æ—Å"""
    try:
        conn = sqlite3.connect(DATABASE_PATH)
        c = conn.cursor()
        c.execute('UPDATE users SET balance = balance - 1 WHERE user_id = ?', (user_id,))
        conn.commit()
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–æ–≤—ã–π –±–∞–ª–∞–Ω—Å
        c.execute('SELECT balance FROM users WHERE user_id = ?', (user_id,))
        new_balance = c.fetchone()[0]
        conn.close()
        
        print(f"‚úÖ –°–ø–∏—Å–∞–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞ –¥–ª—è {user_id}. –ù–æ–≤—ã–π –±–∞–ª–∞–Ω—Å: {new_balance}")
        return True
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ —É–º–µ–Ω—å—à–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞: {e}")
        return False

# –ö–æ–º–∞–Ω–¥–∞ /start
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user = update.message.from_user
    
    # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø–æ–ª—É—á–∞–µ–º –±–∞–ª–∞–Ω—Å
    balance = get_user_balance(user.id)
    
    # –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    keyboard = [
        [InlineKeyboardButton("üì± –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ", web_app={"url": "https://shkarinadust-cmyk.github.io/tarot-bot-miniapps/frontend/"})]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    welcome_text = (
        f"–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é, {user.first_name}! üëã\n\n"
        f"–ú–µ–Ω—è –∑–æ–≤—É—Ç **–°–ø—É—Ç–Ω–∏–∫**, –∏ —è –≥–æ—Ç–æ–≤ –ø–æ–º–æ—á—å –≤–∞–º —Å –∫–∞—Ä—Ç–∞–º–∏ –¢–∞—Ä–æ.\n\n"
        f"‚ú® **–£ –≤–∞—Å –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã –¥–ª—è —Ä–∞—Å–∫–ª–∞–¥–æ–≤** ‚ú®\n\n"
        f"–Ø —É–º–µ—é:\n"
        f"‚Ä¢ –î–µ–ª–∞—Ç—å **–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–∞—Å–∫–ª–∞–¥—ã** –Ω–∞ –≤–∞—à–∏ –≤–æ–ø—Ä–æ—Å—ã\n"
        f"‚Ä¢ –î–∞–≤–∞—Ç—å **–≥–ª—É–±–æ–∫–∏–µ —Ç—Ä–∞–∫—Ç–æ–≤–∫–∏** –∫–∞—Ä—Ç\n" 
        f"‚Ä¢ –ü–æ–¥–±–∏—Ä–∞—Ç—å –∫–∞—Ä—Ç—ã **–ø–æ —Ç–µ–º–∞—Ç–∏–∫–µ** –≤–∞—à–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞\n"
        f"‚Ä¢ –ü—Ä–µ–¥–ª–∞–≥–∞—Ç—å **–±–µ—Å–ø–ª–∞—Ç–Ω—É—é –∫–∞—Ä—Ç—É –¥–Ω—è** (/card)\n\n"
        f"–ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å, –∏ —è —Å–¥–µ–ª–∞—é –¥–ª—è –≤–∞—Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Ä–∞—Å–∫–ª–∞–¥! üîÆ\n\n"
        f"üí´ *–ß—Ç–æ–±—ã –ø–æ–ø–æ–ª–Ω–∏—Ç—å –≤–æ–ø—Ä–æ—Å—ã, –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ:*"
    )
    
    await update.message.reply_text(welcome_text, parse_mode='Markdown', reply_markup=reply_markup)

# –ö–æ–º–∞–Ω–¥–∞ /balance
async def balance_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user = update.message.from_user
    balance = get_user_balance(user.id)
    
    # –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    keyboard = [
        [InlineKeyboardButton("üí≥ –ü–æ–ø–æ–ª–Ω–∏—Ç—å –≤–æ–ø—Ä–æ—Å—ã", web_app={"url": "https://shkarinadust-cmyk.github.io/tarot-bot-miniapps/frontend/"})]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    balance_text = (
        f"üí´ **–í–∞—à –±–∞–ª–∞–Ω—Å: {balance} –≤–æ–ø—Ä–æ—Å–æ–≤**\n\n"
        f"–ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å –º–æ–∂–Ω–æ –≤ –Ω–∞—à–µ–º –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:\n\n"
        f"–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å:"
    )
    
    await update.message.reply_text(balance_text, parse_mode='Markdown', reply_markup=reply_markup)

# –ö–æ–º–∞–Ω–¥–∞ /card
async def daily_card(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ö–∞—Ä—Ç–∞ –¥–Ω—è"""
    card_reading = tarot_ai.create_intelligent_reading("–ö–∞—Ä—Ç–∞ –¥–Ω—è")
    await update.message.reply_text(card_reading, parse_mode='Markdown')

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±—ã—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_message = update.message.text
    user = update.message.from_user
    
    # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∫–æ—Ä–æ—Ç–∫–∏–µ –æ—Ç–≤–µ—Ç—ã —Ç–∏–ø–∞ "–î–∞", "–ù–µ—Ç"
    if user_message.lower() in ['–¥–∞', '–Ω–µ—Ç', '–æ–∫', '—Ö–æ—Ä–æ—à–æ', '—Å–ø–∞—Å–∏–±–æ', '–ø–æ–Ω—è—Ç–Ω–æ']:
        await update.message.reply_text(
            "üí´ –ó–∞–¥–∞–π—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –≤–æ–ø—Ä–æ—Å –¥–ª—è —Ä–∞—Å–∫–ª–∞–¥–∞!\n\n"
            "–ù–∞–ø—Ä–∏–º–µ—Ä:\n"
            "‚Ä¢ ¬´–ß—Ç–æ –º–µ–Ω—è –∂–¥–µ—Ç –≤ –ª—é–±–≤–∏ –¥–æ –∫–æ–Ω—Ü–∞ –≥–æ–¥–∞?¬ª\n" 
            "‚Ä¢ ¬´–ö–∞–∫ —Å–ª–æ–∂–∏—Ç—Å—è –º–æ—è –∫–∞—Ä—å–µ—Ä–∞?¬ª\n"
            "‚Ä¢ ¬´–°—Ç–æ–∏—Ç –ª–∏ –Ω–∞—á–∏–Ω–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç?¬ª\n"
            "‚Ä¢ ¬´–ß—Ç–æ –¥—É–º–∞–µ—Ç –æ–±–æ –º–Ω–µ —ç—Ç–æ—Ç —á–µ–ª–æ–≤–µ–∫?¬ª\n\n"
            "–Ø —Å–¥–µ–ª–∞—é –¥–ª—è –≤–∞—Å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ä–∞—Å–∫–ª–∞–¥ –∏–∑ 3 –∫–∞—Ä—Ç! üîÆ",
            parse_mode='Markdown'
        )
        return
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–ª–∞–Ω—Å
    balance = get_user_balance(user.id)
    print(f"üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –¥–ª—è {user.id}: {balance} –≤–æ–ø—Ä–æ—Å–æ–≤")
    
    if balance <= 0:
        # –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è
        keyboard = [
            [InlineKeyboardButton("üí≥ –ü–æ–ø–æ–ª–Ω–∏—Ç—å –≤–æ–ø—Ä–æ—Å—ã", web_app={"url": "https://shkarinadust-cmyk.github.io/tarot-bot-miniapps/frontend/"})]
        ]
        reply_markup = InlineKeyboardMarkup(keyboard)
        
        await update.message.reply_text(
            "‚ùå **–î–ª—è –Ω–æ–≤–æ–≥–æ —Ä–∞—Å–∫–ª–∞–¥–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–ø–æ–ª–Ω–∏—Ç—å –≤–æ–ø—Ä–æ—Å—ã**\n\n"
            "–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:",
            parse_mode='Markdown',
            reply_markup=reply_markup
        )
        return
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ—Ä–∞–∑—É "–¥—É–º–∞—é"
    thinking_message = await update.message.reply_text(
        f"{tarot_ai.get_thinking_phrase()}",
        parse_mode='Markdown'
    )
    
    # –ò–º–∏—Ç–∏—Ä—É–µ–º "–¥—É–º–∞–Ω–∏–µ"
    await update.message.reply_chat_action(action='typing')
    time.sleep(2)
    
    # –£–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ "–¥—É–º–∞—é"
    await thinking_message.delete()
    
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ü–†–û–î–í–ò–ù–£–¢–´–ô –ò–ò –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–∞—Å–∫–ª–∞–¥–∞
    answer = tarot_ai.create_intelligent_reading(user_message)
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ä–∞—Å–∫–ª–∞–¥
    await update.message.reply_text(answer, parse_mode='Markdown')
    
    # –£–º–µ–Ω—å—à–∞–µ–º –±–∞–ª–∞–Ω—Å
    if decrease_balance(user.id):
        print(f"‚úÖ –í–æ–ø—Ä–æ—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –¥–ª—è {user.id}")
    else:
        print(f"‚ùå –û—à–∏–±–∫–∞ —Å–ø–∏—Å–∞–Ω–∏—è –≤–æ–ø—Ä–æ—Å–∞ –¥–ª—è {user.id}")

# –û—à–∏–±–∫–∏
async def error(update: Update, context: ContextTypes.DEFAULT_TYPE):
    logger.warning(f'Update {update} caused error {context.error}')

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
def main():
    # –°–æ–∑–¥–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    application = Application.builder().token(BOT_TOKEN).build()
    
    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
    application.add_handler(CommandHandler("start", start))
    application.add_handler(CommandHandler("balance", balance_command))
    application.add_handler(CommandHandler("card", daily_card))
    application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))
    
    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
    application.add_error_handler(error)
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
    print("ü§ñ –ë–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è...")
    print("‚úÖ –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ò–ò –¢–∞—Ä–æ: –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ")
    print("üì± –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–Ω–æ–ø–∫–∏ –¥–ª—è –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è")
    print("üí´ 10 –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
    print("üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∞")
    print("üé¥ –û–∂–∏–¥–∞–µ–º –≤–æ–ø—Ä–æ—Å—ã...")
    
    application.run_polling()
    print("‚úÖ –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç!")

if __name__ == '__main__':
    main()